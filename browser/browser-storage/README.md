# 브라우저 저장소

## 쿠키(Cookie)와 세션(Session)의 차이는 무엇인가요?

**쿠키**

- 클라이언트 측에 저장되는 key-value 형태의 데이터로, 주로 인증 정보나 사용자 설정 등을 저장하며 요청 시마다 자동으로 서버에 전송됨.
- 저장형식: text
- 만료시점: 쿠키 저장시 설정(설정 없으면 브라우저 종료 시) expires 속성을 정의해 무효화 시키면 삭제될 날짜 정할 수 있음
- 용량제한: 한 도메인 당 20 개, 한 쿠키 당 4KB, 클라가 모르게 접속되는 사이트에 의하여 설정될 수 있기 때문에 쿠키로 인해 문제가 생기는 것을 막고자 이렇게 설정

**세션**

- 서버 측에 저장되며, 클라이언트는 세션 ID만 쿠키 형태로 갖고 있고, 서버가 이 ID를 기준으로 사용자 정보를 관리.
- 저장형식: Object
- 용량제한: 제한 없음

쿠키는 상대적으로 보안에 취약하고 저장 용량이 작지만, 세션은 보안 측면에서 강점이 있으며 민감한 정보를 관리하기에 적합

## 쿠키, localStorage, sessionStorage의 차이

|   항목    |            쿠키             |         localStorage          |   sessionStorage    |
| :-------: | :-------------------------: | :---------------------------: | :-----------------: |
| 저장 위치 |         클라이언트          |          클라이언트           |     클라이언트      |
| 만료 시점 | 설정된 Expires 또는 Max-Age | 수동으로 제거하지 않으면 영구 | 브라우저 탭 종료 시 |
|  자동 전  |    송 요청마다 자동 전송    |              ❌               |         ❌          |
| 용량 제한 |           약 4KB            |           약 5~10MB           |      약 5~10MB      |
|  보안성   |        낮음 (전송됨)        |        상대적으로 높음        |   상대적으로 높음   |

쿠키는 서버와의 요청/응답에 포함되어 자동 전송되기 때문에 인증 정보나 세션 ID 저장 등에 많이 사용됨

반면 localStorage와 sessionStorage는 브라우저에만 저장되고, HTTP 요청에는 포함되지 않아 보다 보안에 유리하며 클라이언트 측 상태 관리나 캐싱 용도로 자주 사용함

## localStorage에 JWT 토큰을 저장해도 괜찮을까요?

XSS(Cross-Site Scripting(크로스 사이트 스크립팅))에 취약하므로 안전하지 않음

일반적으로 XSS 공격을 우려해서 localStorage에 민감한 정보(JWT access token 등)를 저장하는 건 권장되지 않음. 대신 HTTP-only 쿠키를 사용하는 것이 보안적으로 더 안전

## HTTP-only 쿠키란?

**HTTP-only 쿠키**

- 자바스크립트에서 접근할 수 없는 쿠키로,
  document.cookie로 읽거나 수정할 수 없도록 브라우저가 제한함.
- 서버에서 Set-Cookie 헤더로 설정되며, 이후 브라우저가 자동으로 요청 시 전송하지만 클라이언트 JS에서는 접근이 불가능해 XSS 공격으로부터 보호할 수 있음
- 주로 JWT 토큰 같은 인증 정보를 저장할 때 사용되며,
  CSRF에 대비하려면 Secure, SameSite 속성과 함께 설정하는 것이 권장됨

## 브라우저 저장소는 언제 어떤 걸 써야 하나요?

- `localStorage`:
  - 사용자 테마, 언어 설정 등 영구 캐싱
- `sessionStorage`:
  - 인증 플로우 중 임시 상태 저장 (ex: OAuth 로그인 중간 상태)
- `IndexedDB`:
  - 대용량 데이터 저장 필요할 때 (ex: 오프라인용 앱, 파일 캐시)
- `cookie`:
  - 세션 인증 / 자동 로그인, 서버와 동기화가 필요한 정보

## 브라우저가 쿠키를 어떻게 전송하나요?

브라우저는 동일한 도메인, 경로 조건이 일치하는 쿠키를 HTTP 요청의 Cookie 헤더에 자동으로 포함시켜 전송. Secure, HttpOnly, SameSite 같은 속성을 활용해 보안 정책을 설정할 수 있음.

## XSS (Cross Site Scripting) 공격

공격자가 악성 스크립트를 웹 페이지에 주입해, 이를 보는 사용자의 브라우저에서 실행되게 하는 공격

- 사용자의 쿠키 탈취, localStorage 내용 노출, DOM 조작, 피싱 유도에 많이 사용됨
- 사용자가 로그인 중이라면 세션 탈취도 가능

`localStorage`, `sessionStorage`에 저장된 데이터는 JavaScript로 접근 가능하므로 XSS 공격에 취약함. 반면, `HttpOnly` 쿠키는 JS에서 접근할 수 없으므로 XSS 방어에 유리

## CSRF (Cross Site Request Forgery)

사용자가 로그인된 상태에서 공격자가 만든 악성 사이트를 방문했을 때, 브라우저가 기존의 인증 쿠키를 자동으로 포함하여 서버에 요청을 보내도록 유도하는 방식

ex)

1. 사용자가 로그인된 상태에서 공격자의 사이트 방문
2. 공격자의 `<img src="https://yourbank.com/transfer?to=attacker&amount=10000">` 실행됨
3. 사용자의 세션 쿠키가 자동 전송되어 요청이 실제처럼 동작

- 사용자가 모르게 금전 거래, 게시글 작성, 비밀번호 변경 등이 일어남

쿠키 기반 인증(특히 세션 쿠키)은 브라우저가 자동 전송하기 때문에 CSRF에 취약함. localStorage 기반 토큰 인증은 자동 전송되지 않아서 CSRF 방어에 유리 (단, XSS엔 약함)

## XSS vs CSRF

XSS는 악성 스크립트가 사용자 브라우저에서 실행되는 공격으로, localStorage나 sessionStorage에 저장된 데이터가 탈취될 수 있음.

CSRF는 로그인된 사용자의 세션 쿠키를 이용한 요청 위조 공격.

때문에 민감한 정보를 저장할 땐 HttpOnly 쿠키를 사용해 XSS에 안전하게 만들고, CSRF에 대응하려면 SameSite 쿠키 설정이나 CSRF 토큰을 사용하는 방식이 필요

## SSR + 로그인 인증 시 토큰 어디에 저장하세요?

- `HttpOnly + Secure + SameSite` 쿠키에 access token 저장
- 필요하면 refresh token 분리해서도 저장
- 클라이언트에서 접근할 수 없는 게 장점 (XSS 방어)

## SameSite 쿠키 속성에 대해 설명해주세요

SameSite 속성은 쿠키가 제3자 요청(크로스 사이트)에 대해 어떻게 동작할지를 제어. CSRF 방어에 중요한 역할을 함.

- `Strict`: 크로스 사이트 요청에는 절대 쿠키 전송 X
- `Lax`: GET 요청만 허용
- `None`: 어떤 요청에도 전송 가능 (단, `Secure` 필수)

## `Secure`, `HttpOnly` 쿠키 속성은 왜 필요한가요?

Secure는 해당 쿠키가 HTTPS 연결에서만 전송되도록 제한하는 속성으로, 중간자 공격(MITM)을 방지하기 위해 필요.

HttpOnly는 자바스크립트에서 해당 쿠키에 접근할 수 없도록 만들어 XSS 공격으로부터 인증 정보를 보호할 수 있음

이 두 속성은 민감한 정보를 담은 쿠키(예: 인증 토큰) 보안에 필수적

## 쿠키에 저장 가능한 용량은 얼마나 되나요?

일반적으로 도메인당 약 4KB까지 저장할 수 있으며,
도메인당 쿠키 개수(20~50개), 전체 쿠키 수(최대 300개) 제한이 있음.

이 때문에 쿠키는 소량의 상태 정보(예: 세션 ID)만 저장하는 용도로 사용됨.

## localStorage는 브라우저 간 공유되나요?

❌ localStorage는 동일한 origin(도메인 + 프로토콜 + 포트) 내에서만 접근 가능하고, 브라우저 간은 물론, 다른 탭이나 브라우저 세션 간에도 공유되지 않음.

즉, 사용자가 같은 사이트를 Chrome과 Firefox에서 열면 각 브라우저에 독립된 localStorage가 존재, 공유 안됨.

이로 인해 세션 공유나 자동 로그인 등의 처리는 서버 또는 쿠키 기반으로 처리하는 것이 일반적.
