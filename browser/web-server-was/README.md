# Web Server, WAS

## Web Server VS WAS

    **Web Server (웹 서버)**

    - Http 프로토콜을 기반으로, 클라이언트의 요청을 서비스하는 기능을 담당
    - 요청에 맞게 두 가지 기능 중 선택해서 제공해야함
        - 정적 컨텐츠 제공: WAS를 거치지 않고 바로 자원 제공
        - 동적 컨텐츠 제공: 클라이언트 요청을 WAS에 보내고, WAS에서 처리한 결과를 클라이언트에게 전달
    - 예: Nginx, Apache

    **WAS (Web Application Server)**

    - DB 조회 및 다양한 로직 처리 요구시 동적인 컨텐츠를 제공하기 위해 만들어진 어플리케이션 서버
    - HTTP를 통해 어플리케이션을 수행해주는 미들웨어.
    - 웹 컨테이너, 서블릿 컨테이너라고도 불림
    - 비즈니스 로직이 담긴 동적 요청 처리 담당
    - 예: Tomcat, Express.js, Spring Boot, Django

    Web Server는 주로 정적 파일을 서빙하고, WAS는 사용자 요청을 처리하고 비즈니스 로직을 실행하는 서버. 웹 서버는 빠르고 가볍기 때문에 프록시 역할도 함께 수행하며, 정적/동적 요청을 적절히 분리해 서버 자원을 효율적으로 활용할 수 있도록 도와줌.

## 웹서버와 웹어플리케이션 서버를 분리한 이유는?

**웹서버** → 정적 컨텐츠만 처리하도록 기능 분배를 해서 서버 부담을 줄이는 것.
클라이언트가 이미지 파일을 요청 보낼 때, 웹 문서가 클라이언트로 보내질 때 이미지 파일과 같은 정적 파일은 함께 보내지지 않음.
먼저 html 문서를 받고, 이에 필요한 이미지 파일들을 다시 서버로 요청해서 받아오는 것.
따라서 웹 서버를 통해서 정적인 파일을 애플리케이션 서버까지 가지 않고 앞단에 빠르게 보낼 수 있음.
**Web Application Server** → WAS를 통해 요청에 맞는 데이터를 DB에서 가져와 비즈니스 로직에 맞게 그때마다 결과를 만들고 제공하면서 자원을 효율적으로 사용할 수 있음.
동적인 콘텐츠를 제공해야 할 때, 웹 서버만으로는 사용자가 원하는 요청에 대한 결과값을 모두 미리 만들어 두고 서비스하기에는 자원이 절대적으로 부족. 그렇기 때문에 WAS를 통해 요청이 들어올 때마다 DB와 비즈니스 로직을 통해 결과물을 만들어 제공

## Static pages vs Dynamic Pages

**Static pages**:
바뀌지 않는 페이지. 웹 서버는 파일 경로 이름을 받고, 경로와 일치하는 file contents를 반환함. 항상 동일한 페이지 반환
**Dynamic Pages**:
인자에 따라 바뀌는 페이지, 동적인 contents 반환
웹 서버에 의해 실행되는 프로그램을 통해 만들어진 결과물 (Servlet: was 위에서 돌아가는 자바 프로그램)

## WAS 가 웹 서버 역할까지 다 처리하지 않는 이유?

WAS는 DB 조회, 다양한 로직을 처리하는데 집중해야함. Web server 역할(정적 컨텐츠 요청까지 처리)하면 부하가 커지고 동적 컨텐츠 처리가 지연되면서 수행 속도가 느려진다 ⇒ 페이지 노출 시간이 늘어나는 문제 발생

WAS 여러대를 연결지어 사용 가능. 웹 서버를 앞 단에 두고, WAS에 오류가 발생하면 사용자가 이용하지 못하게 막아둔 뒤 재시작하여 문제를 해결할 수 있음(사용자는 오류를 느끼지 못하고 이용 가능)

즉: 자원 이용의 효율성 및 장애 극복, 배포 및 유지 보수의 편의성 때문에 웹 서버와 WAS를 분리해서 사용하는 것

## Nginx와 Express의 역할 차이

Nginx는 대표적인 웹 서버 및 리버스 프록시 서버. 정적 파일을 빠르게 서빙하거나, HTTPS, 압축, 캐싱, 로드 밸런싱 등 다양한 인프라 기능을 담당

Express는 Node.js 기반의 웹 애플리케이션 서버로, 주로 REST API 서버나 동적 처리 로직, DB와의 연동 등을 담당
실무에서는 Nginx를 앞단에 두고, 정적 리소스는 Nginx에서, 동적 API 요청은 Express 서버로 라우팅하여 처리

## 정적 파일은 어디에서 서빙하는 게 좋은가요?

일반적으로 정적 리소스는 Web Server, 특히 Nginx나 CDN을 통해 서빙하는 것이 가장 효율적. Web Server는 파일 캐싱, 압축, 빠른 응답을 지원하며, WAS 자원 소모를 줄일 수 있음
또한, 프론트엔드 빌드 결과물(ex. React의 build 디렉토리)을 Nginx를 통해 정적 파일로 배포하면
빠른 초기 로딩과 안정적인 성능을 확보할 수 있음.

## WAS 과부하를 줄이기 위한 방법은?

- 정적 리소스는 Web Server나 CDN에서 처리하여 WAS에 요청을 줄임
- Reverse Proxy(Nginx)를 통해 API 요청을 분산하거나 캐싱
- 로드 밸런서를 통해 WAS 서버를 수평 확장(스케일 아웃).
- 반복 요청이 많은 API는 서버 또는 클라이언트 단에서 캐싱 전략을 적용

## React 앱을 배포할 때 웹 서버와 WAS의 역할은?

React는 CSR 기반의 SPA이므로, 빌드하면 모두 정적 리소스로 변환됨. 따라서 웹 서버(Nginx)를 이용해 /index.html, /static/... 리소스를 정적으로 서빙.
이때 API 요청(/api/\*)은 웹 서버에서 프록시 설정을 통해 WAS(예: Express, Spring 등)로 전달
즉, 웹 서버는 정적 서빙 및 프록시, WAS는 비즈니스 로직 처리하는 구조가 일반적.

## 웹 서버 없이 WAS만 사용할 수 있나요?

기술적으로는 가능. Express.js 같은 WAS는 정적 리소스도 직접 서빙할 수 있고, 모든 요청을 처리할 수 있음
하지만 보통은 성능, 보안, 확장성 등을 고려하여 웹 서버와 WAS를 분리하는 게 일반적
예를 들어 Nginx가 HTTPS 인증서를 처리하거나, gzip 압축, HTTP2 지원, 정적 캐싱 등을 맡는 것이 더 효율적.

## Reverse Proxy란?

클라이언트와 실제 서버(WAS) 사이에 위치하여, 클라이언트의 요청을 대신 받아서 적절한 서버에 전달해주는 중간 서버

- 사용자는 WAS가 아니라 Nginx에게 먼저 요청을 보냄
- Nginx는 요청 내용을 분석해서 해당 요청을 처리할 WAS 또는 다른 서버에 요청을 전달(forwarding)
- 응답을 받아서 다시 사용자에게 전달

Forward Proxy와의 차이점
| 구분 | Proxy 대상 | 대표 사용 예 |
| ----------------- | -------------------------- | ----------------------- |
| **Forward Proxy** | 사용자(클라이언트) → 외부 | 사내 인터넷 필터링, VPN |
| **Reverse Proxy** | 외부 요청 → 내부 서버(WAS) | Nginx, API Gateway 등 |

리버스 프록시는 클라이언트와 WAS 사이에서 요청을 중개하는 서버. Nginx를 리버스 프록시로 설정하면 정적 파일 서빙, HTTPS 처리, API 요청 분기 등을 효율적으로 처리할 수 있어 실무에서는 거의 필수
